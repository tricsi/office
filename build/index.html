<!DOCTYPE html><html><head><title>Office 404</title><meta name="viewport"content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="monetization"content="$ilp.uphold.com/YLmwMmr82Kpe"><style>body,html{display:flex;width:100%;height:100%;margin:0;padding:0;overflow:hidden;background:#000}#game{margin:auto;width:100%;align-self:center;justify-self:center}*{-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;user-select:none}@media (min-aspect-ratio:9 / 16){#game{width:auto;height:100%}}</style></head><body><canvas id="game"width="108"height="192"></canvas><script>!function(){const t=new Map;function e(t){return t.replace(/[^-_\w]+/," ").trim().split(" ").filter((t=>!!t))}function s(i,n,o=t){for(const t of e(i))o instanceof Map?(o.has(t)||o.set(t,[]),o.get(t).push(n)):o.addEventListener(i,n,!1);return s}function i(s,n,o=t){for(const t of e(s))if(o instanceof Map){const e=o.get(t);if(o){const t=e.indexOf(n);t>=0&&e.splice(t,1)}}else o.removeEventListener(s,n,!1);return i}function n(e,s,i,o=t){const a={name:e,target:s,data:i};return o.get("all")?.forEach((t=>t(a))),o.get(e)?.forEach((t=>t(a))),n}const o={};function a(t,e){const s=t.code;return o[s]!==e&&(o[s]=e,n(e?"down":"up",s,o)),!1}const h=document;s("keydown",(t=>a(t,1)),h)("keyup",(t=>a(t,0)),h);const r=navigator.userAgent.match(/(Android|iPhone|iPad|iPod)/i);function c(t=1,e=0,s=!1){if(0>=t)return t;const i=233280;c.SEED=(9301*c.SEED+49297)%i;let n=(e=e?c.SEED*e%i:c.SEED)/i*t;return s?Math.round(n):n}function l(t,e){return t.x*=e,t.y*=e,t}function p(t,e){const{x:s,y:i}=t,n=Math.sin(e),o=Math.cos(e);return t.x=s*o-i*n,t.y=s*n+i*o,t}function u(t,e){return!(t.x>e.x||e.x>t.x+t.w||t.y>e.y||e.y>t.y+t.h)}function d(t,e,s){if(e||s){const[i,n,o,a,h,r,c,l,p]=t;t[6]=e*i+s*a+c,t[7]=e*n+s*h+l,t[8]=e*o+s*r+p}return t}function f(t,e,s=e){return 1===e&&1===s||(t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=s,t[4]*=s,t[5]*=s),t}function y(t,e){if(e){const s=Math.sin(e),i=Math.cos(e),[n,o,a,h,r,c]=t;t[0]=i*n+s*h,t[1]=i*o+s*r,t[2]=i*a+s*c,t[3]=i*h-s*n,t[4]=i*r-s*o,t[5]=i*c-s*a}return t}c.SEED=Math.random();class m{constructor(t={}){this.mat=new Float32Array([1,0,0,0,1,0,0,0,1]),this.param={},this.children=[],this.param={x:0,y:0,r:0,s:1,p:null,...t},t.p?.add(this)}each(t){for(let e=this.children.length-1;e>=0;e--)t(this.children[e],e)}set(t){const e=this.param.p;t.p!==e&&(void 0!==t.p&&e?.remove(this),t.p?.add(this)),this.param={...this.param,...t},this.compute(),this.each((t=>t.compute()))}update(t){this.each((e=>e.update(t)))}add(t){0>this.children.indexOf(t)&&(this.children.push(t),t.param.p=this)}remove(t){const e=this.children.indexOf(t);0>e||(this.children.splice(e,1),t.param.p=null)}compute(){const{x:t,y:e,r:s,s:i,sx:n,sy:o,p:a}=this.param,h=this.mat;((t,e)=>{e?t.set(e):(t.fill(0),t[0]=1,t[4]=1,t[8]=1)})(h,a?.mat),d(h,t,e),y(h,s),f(h,n||i,o||i)}}var w=new class extends m{constructor(){super();const t=((t,e=document)=>e.querySelector("#game"))();this.gl=t.getContext("webgl"),this.param={w:t.width,h:t.height,z:1,...this.param},this.resize(),s("resize",(()=>this.resize()),window)}resize(){const t=this.gl.canvas,{w:e,h:s}=this.param,i=Math.ceil(t.clientWidth/e);t.width=e*i,t.height=s*i,this.gl.viewport(0,0,t.width,t.height),this.param.z=i,this.compute()}compute(){const{x:t,y:e,z:s,r:i,s:n,p:o}=this.param,{width:a,height:h}=this.gl.canvas,r=((t,e,s)=>(t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/s,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t))(this.mat,a,h);o&&((t,e)=>{const[s,i,n,o,a,h,r,c,l]=t,[p,u,d,f,y,m,w,x,g]=e;t[0]=p*s+u*o+d*r,t[1]=p*i+u*a+d*c,t[2]=p*n+u*h+d*l,t[3]=f*s+y*o+m*r,t[4]=f*i+y*a+m*c,t[5]=f*n+y*h+m*l,t[6]=w*s+x*o+g*r,t[7]=w*i+x*a+g*c,t[8]=w*n+x*h+g*l})(r,o.mat),d(r,a/2,h/2),f(r,s),d(r,-t,-e),y(r,-i),f(r,n)}raycast(t){const{x:e,y:s,z:i,r:n,s:o}=this.param,{clientWidth:a,clientHeight:h}=document.body;var r,c;(r=t).x-=(c={x:a/2,y:h/2}).x,r.y-=c.y,l(t,1/i),((t,e)=>{t.x+=e.x,t.y+=e.y})(t,{x:e,y:s}),p(t,n),l(t,1/o)}};const x={x:1/0,y:1/0};function g(t,e){if(x.x=t.clientX,x.y=t.clientY,w.raycast(x),n("pointer",x),void 0!==e){const s=e?"down":"up",i="Mouse"+t.button;o[i]=e,n(s,i,o)}}const v=document.body;s("contextmenu",(t=>t.preventDefault()),v)("mousedown",(t=>g(t,1)),v)("mousemove",(t=>g(t)),v)("mouseup",(t=>g(t,0)),v);var A={size:[289,46],margin:1,frames:{tile:[1,1],font:[1,19],icon:[1,29],tiny:[71,29],ptc:[241,1]}};class E extends m{constructor(t={}){super({n:"",f:0,w:0,h:0,px:0,py:0,mh:0,mv:0,c:"",a:1,...t}),this.mesh=new Float32Array(8),this.tint=new Float32Array(4),this.box=((t=0,e=0,s=1,i=1)=>({x:t,y:e,w:s,h:i}))(),this.compute();let{w:e,h:s,mh:i,mv:n}=this.param;const o={...this.param,x:e,y:s,r:0,px:e,py:s,mh:0,mv:0,p:this};i&&new E({...o,x:i,sx:-1,sy:1}),n&&new E({...o,y:n,sx:1,sy:-1}),i&&n&&new E({...o,x:i,y:n,sx:-1,sy:-1})}set(t){super.set(t),this.children.forEach((t=>t instanceof E&&((t,e)=>{const{x:s,y:i,w:n,h:o}=t;return t.x=Math.min(s,e.x),t.y=Math.min(i,e.y),t.w=Math.max(s+n,e.x+e.w)-t.x,t.h=Math.max(i+o,e.y+e.h)-t.y,t})(this.box,t.box)))}compute(){super.compute();const{w:t,h:e,px:s,py:i,c:n,a:o,p:a}=this.param,h=this.mat;d(h,-s,-i),a instanceof E?this.tint.set(a.tint):this.tint.fill(1),n.split("").forEach(((t,e)=>this.tint[e]*=parseInt(t,16)/15)),this.tint[3]*=o;const r=this.mesh;r.set([h[6],h[7],h[0]*t+h[6],h[1]*t+h[7],h[3]*e+h[6],h[4]*e+h[7],h[0]*t+h[3]*e+h[6],h[1]*t+h[4]*e+h[7]]);const c=this.box;c.x=Math.min(r[0],r[2],r[4],r[6]),c.y=Math.min(r[1],r[3],r[5],r[7]),c.w=Math.max(r[0],r[2],r[4],r[6])-c.x,c.h=Math.max(r[1],r[3],r[5],r[7])-c.y}}class T extends E{constructor(t,e){super(t),this.font={ha:0,va:0,ls:1,lg:1,...this.param,r:0,s:1,sx:0,sy:0,c:"ffff",p:this},this.text(e)}text(t=""){const{children:e,font:s}=this,{w:i,h:n,ha:o,va:a,ls:h,lg:r}=s;let c=0,l=0,p=0;for(const o of t.split("\n")){let t=0;for(let n=0;o.length>n;n++){const a=T.idx.indexOf(o.charAt(n).toUpperCase());0>a||(e.length>l?e[l].set({f:a,x:t,y:c}):new E({...s,f:a,x:t,y:c}),l++),t+=i+h}c+=n+r,p=Math.max(t,p)}this.set({n:"",px:Math.round(p*o/2),py:Math.round((c-r)*a/2)}),e.length=l}}T.idx="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,.?!$";var I={ptc:{n:"ptc",w:4,h:4,px:2,py:2},font:{n:"font",w:6,h:8,c:"fff"},tiny:{n:"tiny",w:3,h:5,c:"999"},icon:{n:"icon",w:16,h:16,px:8,py:8},tile:{n:"tile",w:16,h:16,px:8,py:8},init:[0,20,10,10,10,0,0,5,2,0,0,0,0,0],odds:[0,45,20,10,2,0,0,2,15,2,0,0,2,2],coin:[0,5,10,20,50,100,500,0,50,100,0,500,0,100],shop:[5,0,0,0,25,25,0,20,0,0,0,0,15,10],coil:[0,0,0,0,200,250,0,350,0,0,0,0,500,1e3],price:[0,0,0,0,300,400,0,500,0,0,0,0,750,1500]};const b={time:0,scale:1},M=[];function P(t=b,e=M){const s=Date.now()/1e3,i=Math.min((s-t.time)*t.scale,.1);t.time=s;for(const[t]of e)t(i);requestAnimationFrame((()=>P(t,e)))}function S(t,e=0,s=M){s.push([t,e]),s.sort(((t,e)=>t[1]-e[1]))}function C(t,e,s){return new Promise((i=>{let n=t;const o=a=>{n-=a,0>=n||s&&s()?(((t,e=M)=>{for(let s=e.length-1;s>=0;s--)e[s][0]===t&&e.splice(s,1)})(o),e&&e(1),i()):e&&e(1-n/t)};S(o),o(0)}))}var D;(t=>{t[t.EMPTY=0]="EMPTY",t[t.BOX=1]="BOX",t[t.DRAWER=2]="DRAWER",t[t.SHELF=3]="SHELF",t[t.DESKTOP=4]="DESKTOP",t[t.SERVER=5]="SERVER",t[t.CLOUD=6]="CLOUD",t[t.PLANT=7]="PLANT",t[t.DUDE=8]="DUDE",t[t.BOSS=9]="BOSS",t[t.PINATA=10]="PINATA",t[t.GOLD=11]="GOLD",t[t.SELL=12]="SELL",t[t.WILD=13]="WILD"})(D||(D={}));class L{constructor(t=0,e=0,s=0,i,n=i){this._layer=n,this._count=Array(14),this._empty=!0,this._tiles=[],this._type=s,this._sprite=new E({...I.tile,n:"",x:t,y:e,f:s,p:i})}get type(){return this._type}set type(t){this._type=t,this._empty=!t,this._sprite.set({n:t?"tile":"",f:t})}get sprite(){return this._sprite}get isWild(){return this.type==D.WILD}get isGold(){return this.type==D.GOLD}get isMovable(){return this.type==D.DUDE||this.type==D.BOSS}get targets(){if(this.type===D.DUDE)return this._tiles.filter((t=>t._empty));let t=[];return this.type===D.BOSS&&this.traverse((e=>!e._empty||t.push(e)>0)),t}get isLocked(){let t=!0;return this.traverse((e=>!(!t||!e.isMovable)&&(e.targets.length&&(t=!1),t))),t}get isHover(){return u(this._sprite.box,x)}add(t){return t&&this._tiles.push(t),this}traverse(t,e=[]){if(!e.includes(this)&&(e.push(this),t(this)))for(const s of this._tiles)s.traverse(t,e)}count(){const t=this._count.fill(0);if(this.isWild)for(const e of this._tiles)e._empty||e.isMovable||this.traverse((s=>(s.isWild||s.type===e.type)&&++t[e.type]>0));else this.traverse((e=>e.type===this.type&&++t[this.type]>0));return t}upgrade(t=this.type){D.CLOUD>t?this.type=t+1:D.GOLD>t?this.type=D.GOLD:t===D.WILD&&(this.type=D.PLANT)}async show(){await C(.2,(t=>this._sprite.set({s:t*t}))),this._sprite.set({s:1})}async move(){const t=this.targets;if(t.length){const e=t[t.length>1?c(t.length-1,0,!0):0],s=this.type;e._empty=!1,await this.moveTo(e),e.type=s}}async moveTo(t){const{x:e,y:s,p:i}=this._sprite.param,n=t._sprite.param;this._sprite.set({p:this._layer,s:1.1}),await C(.3,(t=>{const i=1-t*t;this._sprite.set({x:n.x-(n.x-e)*i,y:n.y-(n.y-s)*i})})),this._sprite.set({x:e,y:s,p:i,s:1}),this.type=D.EMPTY}async merge(t=this.type){const e=[];this.traverse((s=>(s===this||t===s.type)&&(this!==s&&e.push(s.moveTo(this)),!0))),e.length&&await Promise.all(e)}async lock(){await C(.2,(t=>this._sprite.set({r:Math.PI*t,s:1-t}))),this.type=10,await C(.2,(t=>this._sprite.set({r:Math.PI*(t+1),s:t}))),this._sprite.set({r:0,s:1})}async clear(){await C(.2,(t=>this._sprite.set({s:1-t*t}))),this._sprite.set({s:1})}}class R extends m{constructor(t,e,s){super(t),this.width=e,this.height=s,this.tiles=[],this.front=new m({p:this}),this.back=new m({p:this});for(let t=0;this.height>t;t++)for(let e=0;this.width>e;e++)this.tiles.push(new L(16*e-40,16*t-40,0,this.back,this.front));for(let t=0;this.height>t;t++)for(let e=0;this.width>e;e++)this.tile(e,t).add(this.tile(e-1,t)).add(this.tile(e+1,t)).add(this.tile(e,t-1)).add(this.tile(e,t+1))}load(t){this.tiles.forEach(((e,s)=>e.type=t[s]||0))}toJSON(){return this.tiles.map((t=>t.type))}tile(t,e){return 0>t||t>=this.width||0>e||e>this.height?null:this.tiles[this.height*e+t]}check(){return this.tiles.reduce(((t,e)=>(e.type>D.EMPTY?0:1)+t),0)}async setTile(t){const e=t.type,s=this.tiles.filter((t=>t.isHover)).pop();s&&(s.type!==D.EMPTY?(e===D.SELL||s.isGold)&&(await s.clear(),n("clear",s),s.type=D.EMPTY,await this.move(s)):e!==D.SELL&&(await t.moveTo(s),s.type=e,n("place",s),s.isMovable||await this.merge(s),await this.lock(s),await this.move(s)))}async move(t){const e=this.tiles.filter((e=>e.isMovable&&e!==t));e.length&&await Promise.all(e.map((t=>t.move())))}async merge(t){let e=t.type,s=t.count();for(;s.filter((t=>t>2)).length;)e=s.reduce(((t,e,s)=>!t&&e>2?s:t),0),await t.merge(e),n("merge",t,s[e]),t.isWild||t.upgrade(e),s=t.count();t.isWild&&t.upgrade(e)}async lock(t){let e=this.tiles.filter((t=>t.isMovable&&t.isLocked));if(e.length)for(n("lock",t,e),await Promise.all(e.map((t=>t.lock())));e.length;){let s=e.length>1?c(e.length-1,0,!0):0;const i=0>e.indexOf(t)?e[s]:t;await this.merge(i),e=e.filter((t=>t.type&&t!==i))}}}class k extends m{constructor(t){super(t),this._data={coin:0,type:1,move:404,item:12},this.tile=new L(-40,-58,0,this),this.shop=new L(0,70,0,this),this.moveLbl=new T({...I.tiny,x:-30,y:-62,va:1,p:this},"Days"),this.moveTxt=new T({...I.font,x:-30,y:-55,va:1,p:this}),this.coinLbl=new T({...I.tiny,x:48,y:-62,va:1,ha:2,p:this},"Money"),this.coinTxt=new T({...I.font,x:48,y:-55,va:1,ha:2,p:this}),this.infoTxt=new T({...I.tiny,y:52,ha:1,p:this},"Click on empty tiles"),this.priceTxt=new T({...I.font,y:84,va:1,ha:1,p:this},"$9999"),this.infoIdx=0,this.infos=["Merge 3 objects","Merge more","Buy better stuff","Subscribers have discount!","Collect the gold bars","Pinata party is cool"],this.load(this._data)}get type(){return this._data.type}set type(t){this._data.type=t,this.tile.type=t,this.move--}get move(){return this._data.move}set move(t){this._data.move=t,this.moveTxt.text(""+t)}get coin(){return this._data.coin}set coin(t){this._data.coin=t,this.enabled=this.enabled,this.coinTxt.text("$"+t)}get price(){return I.price[this.item]}get item(){return this._data.item}set item(t){this._data.item=t,this.shop.type=t,this.enabled=this.enabled,this.priceTxt.text(t?"$"+this.price:"Free")}get enabled(){return this.coin>=this.price}set enabled(t){const e=t?1:.5;this.shop.sprite.set({a:e}),this.priceTxt.set({a:e})}load(t){this.type=t.type,this.coin=t.coin,this.move=t.move,this.item=t.item}async buy(t){const e=this.price,s=this.shop.type;n("buy",this.shop,e),await this.shop.moveTo(this.tile),this.item=t,this.coin-=e,this.type=s,this.move++,await this.shop.show(),this.help()}async info(t){await C(.2,(t=>this.infoTxt.set({a:1-t*t}))),this.infoTxt.text(t),await C(.3,(t=>this.infoTxt.set({a:t*t})))}show(){this.tile.show(),this.help()}help(){switch(this.type){case D.PLANT:this.info("Hmm... a plant?");break;case D.DUDE:this.info("Hey dude!");break;case D.BOSS:this.info("Bosses are annoying!");break;case D.SELL:this.info("You can sell something!");break;case D.WILD:this.info("Diamond merge all stuff!");break;default:this.info(this.infos[this.infoIdx]),++this.infoIdx<this.infos.length||(this.infoIdx=0)}}toJSON(){return this._data}}class O extends m{constructor(){super(...arguments),this.scoreTxt=new T({...I.tiny,c:"fff",ha:1,va:1,p:this})}async score(t,e){const{x:s,y:i}=t.sprite.param;this.scoreTxt.text("$"+e),this.scoreTxt.set({x:s,y:i,a:0}),await C(.2,(t=>this.scoreTxt.set({a:t}))),await C(.3),this.scoreTxt.set({a:0})}}class B extends m{constructor(t,e){super(t),this.time=0,this.loop=!1,this.length=0,this.active=!1,this.finished=!0,this.particles=[],this.props={x:0,y:0,v:0,r:0,a:0,c:1,s:0,t:1,...e};for(let e=0;this.props.c>e;e++)this.particles.push(new E(t))}start(t=-1,e=0,s=this.props.s){this.time=-e,this.loop=0>t,this.length=t+this.props.t,this.props.s=s,this.active=!0,this.finished=!1}stop(t=0){this.length=this.time+this.props.t+t,this.active=!1,this.loop=!1}update(t){if(!this.loop&&this.time>this.length){if(this.finished)return;return this.finished=!0,void(this.props.of&&this.props.of(this))}const e=this.props,s=B.pos,{v:i,c:n,w:o,h:a,s:h,t:r,ou:l}=e;let{a:u,r:d}=e;u=Math.abs(u),c.SEED=h,this.time+=t,this.active=this.loop||this.length-r>this.time,this.particles.forEach(((f,y)=>{const m=h?c(r):r,w=(m+this.time)%r,x=Math.floor((this.time+r-w)/r),g=Math.min(t,w),v=w-g;let{x:A,y:E}=this.param;A+=o?c(o,x)-o/2:0,E+=a?c(a,x)-a/2:0;const T=w>t?f.param:{...this.param,x:A,y:E};s.x=0,s.y=i*g,p(s,d-(h?c(u,x):u/n*y)+u/2),s.x+=e.x*w*w-e.x*v*v+T.x,s.y+=e.y*w*w-e.y*v*v+T.y;const I={...T,...s};l&&l(I,w/r,x),(0>this.time||w>this.time||!this.loop&&r*x+r-m>this.length)&&(I.a=0),f.set(I)}))}}B.pos=((t=0,e=0)=>({x:t,y:e}))();class _ extends m{constructor(){super(...arguments),this.color=["f00","0c0","00f","fc0","0ff","f0f"],this.txt1=new T({...I.font,y:-12,ha:1,p:this}),this.txt2=new T({...I.font,ha:1,p:this}),this.emitter=new B({...I.ptc,y:4,f:1,p:this},{c:40,a:.5,v:-100,y:150,w:90,h:90,s:c(),t:.7,ou:(t,e,s)=>{let i=this.color;t.a=1-e**4,t.r=c(3,s)+3*e,t.c=i[c(i.length-1,s,!0)]}}),this.back=new E({...I.ptc,s:24,f:3,c:"000a",a:0,p:this})}async show(t,e){e&&this.emitter.start(),this.txt1.text("You are"),this.txt2.text(t+"!"),await C(.3,(t=>{this.back.set({a:t}),this.txt1.set({a:t,s:t>.2?3-2*t:0}),this.txt2.set({a:t,s:t>.6?5-4*t:0})}))}async hide(t=!0){this.emitter.active&&this.emitter.stop(),t&&await C(.3,(t=>{const e=1-t*t;this.back.set({a:e}),this.txt1.set({a:e}),this.txt2.set({a:e})}))}emit(t){this.emitter.start(t)}}class F extends m{constructor(t,e){super(t),this.props=e;const{w:s,h:i,m:n}=e,o=Array(s*i).fill(-1),a=Array(s*i).fill(0);let h=0,r=0;for(;n.length>h;){let t=n.charAt(h++),e="|-+".indexOf(t)+1,s=1;e&&(t=n.charAt(h++)),t.match(/[A-Z]/)?t=t.toLowerCase():s=parseInt(n.charAt(h++),36)+1,"0"!==t&&(o.fill(parseInt(t,36)-10,r,r+s),a.fill(e,r,r+s)),r+=s}o.forEach(((t,s)=>{if(0>t)return;const{w:i,h:n}=e.t,o=e.h*n/2;new E({...e.t,x:s%e.w*i+i/2-e.w*i/2,y:Math.floor(s/e.w)*n+n/2-o,px:i/2,py:n/2,sx:1&a[s]?-1:1,sy:2&a[s]?-1:1,p:this,f:t})}))}}const G={scenes:[]},U=new class{constructor(t,e=localStorage){this.prefix=t,this.store=e}key(t){return this.prefix+t}set(t,e=""){void 0!==t?this.store.setItem(this.key(e),JSON.stringify(t)):this.store.removeItem(this.key(e))}get(t=""){try{return JSON.parse(this.store.getItem(this.key(t)))}catch(t){}return null}}("office_404");window.AudioContext=window.AudioContext||window.webkitAudioContext,window.OfflineAudioContext=window.OfflineAudioContext||window.webkitOfflineAudioContext;const N="c,db,d,eb,e,f,gb,g,ab,a,bb,b".split(","),H=[],Q=new Map,Y=new Map;let z,K,J;function X(t,e=K){const s=t[0],i=e.createGain();i.connect(e.destination);const n=e.createBiquadFilter();let o;if(n.connect(i),"custom"===s)o=e.createBufferSource(),o.buffer=J,o.loop=!0;else if(o=e.createOscillator(),"string"==typeof s)o.type=s;else{const t=Float32Array.from([0,...s]);o.setPeriodicWave(e.createPeriodicWave(t,t.map((()=>0))))}return o.connect(n),{props:t,ctx:e,src:o,vol:i,filter:n}}function j(t,e,s,i){e instanceof Array?t.setValueCurveAtTime(Float32Array.from(e),i,s-.01):t.setValueAtTime(e,i)}function W(t,e,s=t.props[1],i=0){const n=t.props[2],{src:o,vol:a,filter:h}=t;j(o instanceof OscillatorNode?o.frequency:h.detune,e,s,i),j(a.gain,e?n:0,s,i)}function Z(t,e=t.props[1]){t.src.start(),t.src.stop(e)}function V(t,e,s=Y){const i=new OfflineAudioContext(1,z*e,z);return i.addEventListener("complete",(e=>s.set(t,e.renderedBuffer))),i}async function q(t,e,s){const{length:i}=e,n=V(t,i),o=X(e,n);W(o,s),Z(o),await n.startRendering()}async function $(t,e){const s=e.map((t=>(t=>{let e=0,s=0;const[i,n,o]=t,a=n.split("|");return{props:t,data:a.reduce(((t,e,s)=>t+(s%2?(","+a[s-1]).repeat(parseInt(e)-1):(t?",":"")+e)),"").split(",").map((t=>{const i=t.match(/^([\d\.]+)/);if(i){const n=parseFloat(i[1]),a=t.match(/([a-z]+\d+)/g),h=[n];return s+=n*o,a&&(e=Math.max(a.length,e),h.push(...a.map((t=>{const e=t.match(/([a-z]+)(\d+)/);return e?H[12*parseInt(e[2])+N.indexOf(e[1])]:0})))),h}})),size:e,length:s}})(t))),i=V(t,Math.max(...s.map((t=>t.length))));s.forEach((t=>(({props:t,data:e,size:s},i=K)=>{const n=[];for(let e=0;s>e;e++)n.push(X(t[0],i));let o=0;e.forEach((e=>{const s=e[0]*t[2];n.forEach(((t,i)=>W(t,e[i+1]||0,s,o))),o+=s})),n.forEach((t=>Z(t,o)))})(t,i))),await i.startRendering()}function tt(t,e=-1,s=K){let i=Q.get(t);return i||(i=s.createGain(),i.connect(s.destination),Q.set(t,i)),0>e||e>1||(i.gain.value=e),i}function et(t,e=!1,s="master",i=Y,n=K){if(i.has(t)){let o=n.createBufferSource();return o.loop=e,o.buffer=i.get(t),o.connect(tt(s)),o.start(),o}return null}class st extends m{constructor(t){super(),this.overlay=new _({p:this}),this.score=new O({p:this}),this.hud=new k({p:this}),this.grid=new R({p:this},6,6),this.back=new F({x:8,y:8,p:this},{w:6,h:6,m:"az",t:I.tile}),this.active=!0,this.ended=!1,this.onInput=async t=>{if("Mouse0"===t.target){const{hud:t,grid:e}=this;this.ended?(this.overlay.hide(),this.create()):this.active&&(this.active=!1,t.enabled&&t.shop.isHover?await t.buy(this.roll(I.shop)):await e.setTile(t.tile),e.check()?t.move?this.save():(this.clear(),this.ended=!0,n("promoted"),this.overlay.show("promoted",!0)):(this.clear(),this.ended=!0,n("fired"),this.overlay.show("fired",!1)),this.active=!0)}},this.onPlace=()=>{this.hud.type=this.roll(),this.hud.show()},this.onMerge=t=>{const e=t.target;this.coin(e,t.data),e.type===D.PINATA?(this.overlay.emit(.4),et("pinata")):et("coin")},this.onClear=t=>{const e=t.target;this.coin(e),e.isGold||(this.hud.type=this.roll(),this.hud.show())},this.onALL=t=>{et(t.name)},s("down",this.onInput)("place",this.onPlace)("merge",this.onMerge)("clear",this.onClear)("all",this.onALL),t?(this.hud.load(t.hud),this.grid.load(t.grid)):this.create()}create(){for(const t of this.grid.tiles)t.type=this.roll(I.init);this.hud.load({coin:0,type:1,move:404,item:12}),this.ended=!1,this.save()}save(){const{hud:t,grid:e}=this;U.set({hud:t,grid:e})}clear(){U.set()}coin(t,e=1){const s=I.coin[t.type]*e;s&&(this.score.score(t,s),this.hud.coin+=s)}roll(t=I.odds){let e=c(99);for(let s=t.length-1;s>0;s--){if(t[s]&&t[s]>e)return s;e-=t[s]}return 0}}class it extends m{constructor(t){super(t),this.sound=1,this.twtIcon=new E({...I.icon,x:-40,y:84,f:3,a:0,p:this}),this.sndIcon=new E({...I.icon,x:40,y:84,f:1,a:0,p:this}),this.onInput=async t=>{if("Mouse0"===t.target&&(u(this.sndIcon.box,x)&&(++this.sound>2&&(this.sound=0),this.sndIcon.set({f:this.sound}),n("sound",this.sound)),u(this.twtIcon.box,x))){const t=new URLSearchParams;t.set("url",location.href),t.set("text","Check out OFFICE 404!"),t.set("hashtags","js13k,office404"),window.open("http://www.twitter.com/share?"+t,"_blank")}},s("down",this.onInput)}async show(){await C(.5,(t=>{const e=t*t;this.twtIcon.set({a:e}),this.sndIcon.set({a:e})}))}}class nt extends m{constructor(){super(),this.data=U.get(),this.num=new T({...I.font,y:-10,r:.3,c:"900",ha:1,p:this}),this.logo=new T({...I.font,s:2,c:"eee",va:1,ha:1,p:this}),this.newTxt=new T({...I.font,y:0,ha:1,p:this}),this.loadTxt=new T({...I.font,y:12,ha:1,p:this}),this.clickTxt=new T({...I.tiny,y:12,ha:1,p:this}),this.settings=new it({p:this}),this.clicked=!1,this.onInit=async t=>{if("Mouse0"===t.target){i("down",this.onInit),this.clicked=!0,this.clickTxt.text("Loading...");const t=["sine",.2,[.2,0]],s=[(e=t=>4/(t*Math.PI)*Math.sin(Math.PI*t*.18),Array.from({length:8191},((t,s)=>e(s+1)))),.3,[.5,.2]],n=[[1,1,1,1,0,1,0,1,0,0,0,1],.3,[.1,.2,.1]],o=["sawtooth",.2,[.3,0]],a=["sine",.3,[1,.1,0]],h=["custom",.2,[1,0]];await(async(t=44100,e=new AudioContext)=>{z=t,K=e,"suspended"===e.state&&await e.resume(),J=e.createBuffer(1,2*t,t);const s=J.getChannelData(0);for(let e=0;2*t>e;e++)s[e]=2*Math.random()-1;for(let t=-69;50>t;t++){const e=440*Math.pow(1.0594630943592953,t),s=Math.pow(10,7-e.toFixed().length);H.push(Math.round(e*s)/s)}})(22050),await q("place",a,[110,15,0]),await q("lock",["triangle",.4,[0,.2]],[880,220,880]),await $("clear",[[["square",.2,[.2,0]],"1a6,1c7,1e7",.05]]),await $("coin",[[t,"2a4,2a5",.05]]),await $("buy",[[t,"2a6,2e7,2a7",.05]]),await q("fired",["triangle",1,[.3,0]],[880,110]),await $("promoted",[[t,"1f5a5c6,3f5a5c6,1f5a5c6,3g5b5d6,4a5c6e6",.1],[s,"1f6,3f6,1f6,3g6,4a6",.1],[o,"4f3,1f3,3g3,4a3",.1]]),await $("pinata",[[t,"2g4b4d5,1g4b4d5,1g4b4d5,4c5e5g5",.1],[s,"2g6,1g6,1g6,4c7",.1],[o,"2g2,1g2,1g2,4c3",.1]]),await $("music",[[s,"8|8|1a5,1,1a5,1,2d6,1e6,2f6,7,2e6,2,2e6,2c6,4g5,4,8f6,4e6,20,1a5,1,1a5,1,2d6,1e6,2f6,7,2e6,2,2e6,2c6,4g5,4,8d6,4c6,20|2",.125],[n,"8a4d5f5,8a4c5e5,8g4c5e5,8g4b4d5|10",.125],[o,"1a2,1a2,3f3,1d2,2,1a2,1a2,3e3,1c2,2,1g2,1g2,3e3,1c2,2,1g2,1g2,3d3,1b2,2|8",.125],[a,"1a3,7,1a3,1,1a3,5|20",.125],[h,"8|8|4,1a7,3|24",.125]]),this.sound=this.settings.sound,await this.start()}var e},this.onInput=async t=>{const e=this.load;"Mouse0"===t.target&&(e||this.create)&&(this.hide(),i("down",this.onInput)("pointer",this.onPointer),et("music",!0,"music"),s("sound",(t=>this.sound=t.target)),G.scenes[1]=new st(e?this.data:null))},this.onPointer=()=>{this.loadTxt.set({c:this.load?"0ff":"fff"}),this.newTxt.set({c:this.create?"0ff":"fff"})},this.onCoil=()=>{I.price=I.coil,this.logo.set({c:"c90"})},this.intro(),s("coil",this.onCoil)("down",this.onInit)}get load(){return u(this.loadTxt.box,x)}get create(){return u(this.newTxt.box,x)}set sound(t){tt("master",t>0?.8:0),tt("music",1===t?.2:0)}async intro(){const t=()=>this.clicked;await C(.5,void 0,t),await C(1.5,(t=>this.logo.text("Office".substr(0,Math.ceil(6*t)))),t),this.num.text("404!"),await C(.3,(t=>this.num.set({x:34*t,s:3.7-2*t*t,a:t*t})),t),await C(.5,void 0,t),!this.clicked&&this.clickTxt.text("Click to start")}async start(){this.clickTxt.text(),await C(.5,(t=>{const e=t**4;this.logo.set({y:-80*e}),this.num.set({y:-80*e-10})})),this.newTxt.text("New game"),this.data&&(this.newTxt.set({y:-12}),this.loadTxt.text("Continue")),await C(.3,(t=>{this.newTxt.set({a:t*t}),this.loadTxt.set({a:t*t})})),s("down",this.onInput)("pointer",this.onPointer),await this.settings.show()}async hide(){await C(.5,(t=>{const e=1-t*t;this.newTxt.set({a:e}),this.loadTxt.set({a:e})}))}}function ot(t,e,s,i=!0){i&&(t.count=0);for(let i=s.length-1;i>=0;i--){const n=s[i];ot(t,e,n.children,!1),n instanceof E&&at(t,n,e)}}function at(t,e,s){const{param:i,tint:n,mesh:o}=e,{pos:a,color:h,count:r,size:c}=t;if(i.n in s.frames&&c>r){((t,e,s)=>{let{n:i,f:n,w:o,h:a}=e;const[h,r]=s.size,c=s.margin/h;let[l,p]=s.frames[i];l/=h,p/=r,o/=h,a/=r,l+=(o+c)*Math.floor(n),t.uv.set([l,p,l+o,p,l,p+a,l+o,p+a],8*t.count)})(t,i,s),a.set(o,8*r);let e=16*r;for(let t=0;4>t;t++)h.set(n,4*t+e);t.count++}}const ht=new Map;function rt(t,e,s){const i=t.createShader(e);return t.shaderSource(i,s),t.compileShader(i),i}function ct(t,e,s,i=t.ARRAY_BUFFER,n=ht){n.has(e)||n.set(e,t.createBuffer()),t.bindBuffer(i,n.get(e)),s&&t.bufferData(i,s,t.STATIC_DRAW)}function lt(t,e,s,i){const n=t.getAttribLocation(e,s);t.enableVertexAttribArray(n),t.vertexAttribPointer(n,i,t.FLOAT,!1,0,0)}const pt=w.gl,ut=((t=4096)=>{const e=new Uint16Array(6*t),s=[0,1,2,2,1,3];for(let t=0;e.length>t;t++)e[t]=4*Math.floor(t/6)+s[t%6];return{idx:e,uv:new Float32Array(8*t),pos:new Float32Array(8*t),color:new Float32Array(16*t),count:0,size:t}})(),dt=((t,e,s)=>{const i=t.createProgram();return t.attachShader(i,e),t.attachShader(i,s),t.linkProgram(i),i})(pt,rt(pt,pt.VERTEX_SHADER,"attribute vec2 aUv;attribute vec2 aPos;attribute vec4 aColor;uniform mat3 uProj;varying vec2 vUv;varying vec4 vColor;void main(){vUv=aUv;vColor=aColor;gl_Position=vec4(uProj*vec3(aPos,1),1);}"),rt(pt,pt.FRAGMENT_SHADER,"precision lowp float;uniform sampler2D uImage;varying vec2 vUv;varying vec4 vColor;void main(){gl_FragColor=texture2D(uImage,vUv)*vColor;gl_FragColor.rgb*=gl_FragColor.a;}")),ft=new Image,yt=G.scenes;S((t=>{yt.forEach((e=>e.update(t))),ot(ut,A,yt),pt.clear(pt.COLOR_BUFFER_BIT),((t,e,s,i)=>{const n=t.getUniformLocation(e,"uProj");if("number"==typeof i)t.uniform1f(n,i);else switch(i.length){case 2:t.uniform2fv(n,i);break;case 3:t.uniform3fv(n,i);break;case 4:t.uniform4fv(n,i);break;case 9:t.uniformMatrix3fv(n,!1,i);break;case 16:t.uniformMatrix4fv(n,!1,i)}})(pt,dt,0,w.mat),ct(pt,"aUv",ut.uv),lt(pt,dt,"aUv",2),ct(pt,"aPos",ut.pos),lt(pt,dt,"aPos",2),ct(pt,"aColor",ut.color),lt(pt,dt,"aColor",4),pt.drawElements(pt.TRIANGLES,6*ut.count,pt.UNSIGNED_SHORT,0)}),9),s("load",(()=>{const t=document;yt[0]=new nt,pt.enable(pt.BLEND),pt.clearColor(0,0,0,1),pt.blendFunc(pt.ONE,pt.ONE_MINUS_SRC_ALPHA),pt.useProgram(dt),ct(pt,"idx",ut.idx,pt.ELEMENT_ARRAY_BUFFER),pt.bindTexture(pt.TEXTURE_2D,((t,e,s=!0)=>{const i=t.TEXTURE_2D,n=t.createTexture();return t.bindTexture(i,n),t.texParameteri(i,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(i,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(i,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(i,t.TEXTURE_MAG_FILTER,s?t.NEAREST:t.LINEAR),t.texImage2D(i,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),n})(pt,ft)),P(),s("click",(()=>r&&(async()=>document.fullscreenElement||await document.body.requestFullscreen())()),t),t.monetization&&s(t.monetization,"monetizationstart",(()=>n("coil")))}),ft),ft.src="data:image/png;base64,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"}();</script></body></html>