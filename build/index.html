<!DOCTYPE html><html><head><title>Office 404</title><meta name="viewport"content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="monetization"content="$ilp.uphold.com/YLmwMmr82Kpe"><style>body,html{display:flex;width:100%;height:100%;margin:0;padding:0;overflow:hidden;background:#000}#game{margin:auto;width:100%;align-self:center;justify-self:center}*{-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;user-select:none}@media (min-aspect-ratio:9 / 16){#game{width:auto;height:100%}}</style></head><body><canvas id="game"width="108"height="192"></canvas><script>!function(){const t=new Map;function s(t){return t.replace(/[^-_\w]+/," ").trim().split(" ").filter((t=>!!t))}function e(i,a,n=t){for(const t of s(i))n instanceof Map?(n.has(t)||n.set(t,[]),n.get(t).push(a)):n.addEventListener(i,a,!1);return e}function i(e,a,n=t){for(const t of s(e))if(n instanceof Map){const s=n.get(t);if(n){const t=s.indexOf(a);t>=0&&s.splice(t,1)}}else n.removeEventListener(e,a,!1);return i}function a(s,e=t){return e.get("all")?.forEach((t=>t(s))),e.get(s.name)?.forEach((t=>t(s))),a}const n={};function h(t,s){const e=t.code;return n[e]!==s&&(n[e]=s,a({name:s?"down":"up",target:e,data:n})),!1}const o=document;e("keydown",(t=>h(t,1)),o)("keyup",(t=>h(t,0)),o);const r=navigator.userAgent.match(/(Android|iPhone|iPad|iPod)/i);function c(t=1,s=0,e=!1){if(0>=t)return t;const i=233280;c.SEED=(9301*c.SEED+49297)%i;let a=(s=s?c.SEED*s%i:c.SEED)/i*t;return e?Math.round(a):a}function l(t,s){return t.x*=s,t.y*=s,t}function p(t,s){const{x:e,y:i}=t,a=Math.sin(s),n=Math.cos(s);return t.x=e*n-i*a,t.y=e*a+i*n,t}function u(t,s){return!(t.x>s.x||s.x>t.x+t.w||t.y>s.y||s.y>t.y+t.h)}function d(t,s,e){if(s||e){const[i,a,n,h,o,r,c,l,p]=t;t[6]=s*i+e*h+c,t[7]=s*a+e*o+l,t[8]=s*n+e*r+p}return t}function f(t,s,e=s){return 1===s&&1===e||(t[0]*=s,t[1]*=s,t[2]*=s,t[3]*=e,t[4]*=e,t[5]*=e),t}function m(t,s){if(s){const e=Math.sin(s),i=Math.cos(s),[a,n,h,o,r,c]=t;t[0]=i*a+e*o,t[1]=i*n+e*r,t[2]=i*h+e*c,t[3]=i*o-e*a,t[4]=i*r-e*n,t[5]=i*c-e*h}return t}c.SEED=Math.random();class y{constructor(t={}){this.mat=new Float32Array([1,0,0,0,1,0,0,0,1]),this.param={},this.children=[],this.param={x:0,y:0,r:0,s:1,p:null,...t},t.p?.add(this)}each(t,s=!1){for(let e=this.children.length-1;e>=0;e--){const i=this.children[e];s&&i.each(t,s),t(i,e)}}set(t,s={}){void 0!==t.p&&this.param.p?.remove(this),t.p?.add(this),this.param={...this.param,...t},this.compute(),this.each((t=>t.set(s)))}add(t){0>this.children.indexOf(t)&&(this.children.push(t),t.param.p=this)}remove(t){const s=this.children.indexOf(t);0>s||(this.children.splice(s,1),t.param.p=null)}compute(){const{x:t,y:s,r:e,s:i,sx:a,sy:n,p:h}=this.param,o=this.mat;((t,s)=>{s?t.set(s):(t.fill(0),t[0]=1,t[4]=1,t[8]=1)})(o,h?.mat),d(o,t,s),m(o,e),f(o,a||i,n||i)}}var w=new class extends y{constructor(){super(),this.canvas=((t,s=document)=>s.querySelector("#game"))(),this.gl=this.canvas.getContext("webgl"),this.width=this.canvas.width,this.height=this.canvas.height,this.scale=1,this.resize(),e("resize",(()=>this.resize()),window)}resize(){const t=this.canvas,{width:s,height:e}=this,i=Math.ceil(t.clientWidth/s);t.width=s*i,t.height=e*i,this.gl.viewport(0,0,t.width,t.height),this.scale=i,this.compute()}compute(){const{x:t,y:s,r:e,s:i}=this.param,{width:a,height:n}=this.canvas,h=this.mat;((t,s,e)=>{t[0]=2/s,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/e,t[5]=0,t[6]=-1,t[7]=1,t[8]=1})(h,a,n),d(h,a/2,n/2),f(h,this.scale),d(h,-t,-s),m(h,-e),f(h,i)}raycast(t){const{x:s,y:e,r:i,s:a}=this.param,{clientWidth:n,clientHeight:h}=document.body;var o,r;(o=t).x-=(r={x:n/2,y:h/2}).x,o.y-=r.y,l(t,1/this.scale),((t,s)=>{t.x+=s.x,t.y+=s.y})(t,{x:s,y:e}),p(t,i),l(t,1/a)}};const x={x:1/0,y:1/0};function g(t,s){if(x.x=t.clientX,x.y=t.clientY,w.raycast(x),a({name:"pointer",target:x}),void 0!==s){const e=s?"down":"up",i="Mouse"+t.button;n[i]=s,a({name:e,target:i,data:n})}}const v=document.body;e("contextmenu",(t=>t.preventDefault()),v)("mousedown",(t=>g(t,1)),v)("mousemove",(t=>g(t)),v)("mouseup",(t=>g(t,0)),v);var A={size:[289,46],margin:1,frames:{tile:[1,1],font:[1,19],icon:[1,29],tiny:[71,29],ptc:[241,1]}};class E extends y{constructor(t={}){super({n:"",f:0,w:0,h:0,px:0,py:0,mh:0,mv:0,l:0,c:"",a:1,...t}),this.mesh=new Float32Array(8),this.tint=new Float32Array(4),this.box=((t=0,s=0,e=1,i=1)=>({x:t,y:s,w:e,h:i}))(),this.compute();let{w:s,h:e,mh:i,mv:a}=this.param;const n={...this.param,x:s,y:e,r:0,px:s,py:e,mh:0,mv:0,p:this};i&&new E({...n,x:i,sx:-1,sy:1}),a&&new E({...n,y:a,sx:1,sy:-1}),i&&a&&new E({...n,x:i,y:a,sx:-1,sy:-1})}set(t,s={}){super.set(t,s),this.children.forEach((t=>t instanceof E&&((t,s)=>{const{x:e,y:i,w:a,h:n}=t;return t.x=Math.min(e,s.x),t.y=Math.min(i,s.y),t.w=Math.max(e+a,s.x+s.w)-t.x,t.h=Math.max(i+n,s.y+s.h)-t.y,t})(this.box,t.box)))}compute(){super.compute();const{w:t,h:s,px:e,py:i,c:a,a:n,p:h}=this.param,o=this.mat;d(o,-e,-i),h instanceof E?this.tint.set(h.tint):this.tint.fill(1),a.split("").forEach(((t,s)=>this.tint[s]*=parseInt(t,16)/15)),this.tint[3]*=n;const r=this.mesh;r.set([o[6],o[7],o[0]*t+o[6],o[1]*t+o[7],o[3]*s+o[6],o[4]*s+o[7],o[0]*t+o[3]*s+o[6],o[1]*t+o[4]*s+o[7]]);const c=this.box;c.x=Math.min(r[0],r[2],r[4],r[6]),c.y=Math.min(r[1],r[3],r[5],r[7]),c.w=Math.max(r[0],r[2],r[4],r[6])-c.x,c.h=Math.max(r[1],r[3],r[5],r[7])-c.y}}class T extends E{constructor(t,s){super(t),this.font={ha:0,va:0,ls:1,lg:1,...this.param,r:0,s:1,sx:0,sy:0,c:"ffff",p:this},this.text(s)}text(t=""){const{children:s,font:e}=this,{w:i,h:a,ha:n,va:h,ls:o,lg:r}=e;let c=0,l=0,p=0;for(const n of t.split("\n")){let t=0;for(let a=0;n.length>a;a++){const h=T.idx.indexOf(n.charAt(a).toUpperCase());0>h||(s.length>l?s[l].set({f:h,x:t,y:c}):new E({...e,f:h,x:t,y:c}),l++),t+=i+o}c+=a+r,p=Math.max(t,p)}this.set({n:"",px:Math.round(p*n/2),py:Math.round((c-r)*h/2)}),s.length=l}}T.idx="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,.?!$";class b{constructor(t,s){this.param=t,this.ctx=s,this.srcVol=s.createGain(),this.srcVol.connect(s.destination),this.filter=s.createBiquadFilter(),this.filter.connect(this.srcVol);const e=this.ctx.createBufferSource();if(e.buffer=b.noise,e.loop=!0,e.connect(this.filter),this.src=e,this.oscVol=s.createGain(),this.oscVol.connect(s.destination),this.osc=this.ctx.createOscillator(),"string"==typeof t[0])this.osc.type=t[0];else{const e=Float32Array.from([0,...t[0]]);this.osc.setPeriodicWave(s.createPeriodicWave(e,e.map((()=>0))))}this.osc.connect(this.oscVol)}set(t,s,e,i){s instanceof Array?t.setValueCurveAtTime(Float32Array.from(s),i,e-.01):t.setValueAtTime(s,i)}render(t,s=this.param[1],e=0){this.set(this.osc.frequency,t,s,e),this.set(this.filter.detune,t,s,e),this.set(this.oscVol.gain,t&&this.param[2]||0,s,e),this.set(this.srcVol.gain,t&&this.param[3]||0,s,e)}start(t=this.param[1]){this.src.start(),this.src.stop(t),this.osc.start(),this.osc.stop(t)}}class I{constructor(t){this.param=t,this.size=0,this.length=0;const[s,e,i]=t,a=e.split("|");this.data=a.reduce(((t,s,e)=>t+(e%2?(","+a[e-1]).repeat(parseInt(s)-1):(t?",":"")+s)),"").split(",").map((t=>{const s=t.match(/^([\d\.]+)/);if(s){const e=parseFloat(s[1]);this.length+=e*i;const a=t.match(/([a-z]+\d+)/g);return a?(this.size=Math.max(a.length,this.size),[e].concat(a.map((t=>{let s=t.match(/([a-z]+)(\d+)/);return s?I.freq[12*parseInt(s[2])+I.keys.indexOf(s[1])]:0})))):[e]}}))}render(t){let s=0;const[e,i,a]=this.param,n=[];for(let s=0;this.size>s;s++)n.push(new b(e,t));this.data.forEach((t=>{const e=t[0]*a;n.forEach(((i,a)=>i.render(t[a+1]||0,e,s))),s+=e})),n.forEach((t=>t.start(s)))}}I.keys="c,db,d,eb,e,f,gb,g,ab,a,bb,b".split(","),I.freq=[],window.AudioContext=window.AudioContext||window.webkitAudioContext,window.OfflineAudioContext=window.OfflineAudioContext||window.webkitOfflineAudioContext;var M=new class{constructor(){this.bitrate=44100,this.ctx=new AudioContext,this.mix={},this.buff={}}async init(){const t=this.ctx,s=this.bitrate;"suspended"===t.state&&await t.resume(),b.noise=t.createBuffer(1,2*s,s);const e=b.noise.getChannelData(0);for(let t=0;2*s>t;t++)e[t]=2*Math.random()-1;for(let t=-69;50>t;t++){const s=440*Math.pow(1.0594630943592953,t),e=Math.pow(10,7-s.toFixed().length);I.freq.push(Math.round(s*e)/e)}}mixer(t,s=-1){const e=this.ctx,i=this.mix;return t in i||(i[t]=e.createGain(),i[t].connect(e.destination)),0>s||s>1||(i[t].gain.value=s),i[t]}play(t,s=!1,e="master"){if(t in this.buff){let i=this.ctx.createBufferSource();return i.loop=s,i.buffer=this.buff[t],i.connect(this.mixer(e)),i.start(),i}return null}async sound(t,s,e){const i=this.context(t,s[1]),a=new b(s,i);a.render(e),a.start(),await i.startRendering()}async music(t,s){const e=s.map((t=>new I(t))),i=Math.max(...e.map((t=>t.length))),a=this.context(t,i);e.forEach((t=>t.render(a))),await a.startRendering()}context(t,s){const e=new OfflineAudioContext(1,this.bitrate*s,this.bitrate);return e.addEventListener("complete",(s=>this.buff[t]=s.renderedBuffer)),e}},D={ptc:{n:"ptc",w:4,h:4,px:2,py:2},font:{n:"font",w:6,h:8,c:"fff"},tiny:{n:"tiny",w:3,h:5,c:"999"},icon:{n:"icon",w:16,h:16,px:8,py:8},tile:{n:"tile",w:16,h:16,px:8,py:8},init:[0,20,10,10,10,0,0,5,2,0,0,0,0,0],odds:[0,45,20,10,2,0,0,2,15,2,0,0,2,2],coin:[0,5,10,20,50,100,500,0,50,100,0,500,0,100],shop:[5,0,0,0,25,25,0,20,0,0,0,0,15,10],coil:[0,0,0,0,200,250,0,350,0,0,0,0,500,1e3],price:[0,0,0,0,300,400,0,500,0,0,0,0,750,1500]};const P={time:0,scale:1},S=[];function C(t=P,s=S){const e=Date.now()/1e3,i=Math.min((e-t.time)*t.scale,.1);t.time=e;for(const[t]of s)t(i);requestAnimationFrame((()=>C(t,s)))}function R(t,s=0,e=S){e.push([t,s]),e.sort(((t,s)=>t[1]-s[1]))}function L(t,s,e){return new Promise((i=>{let a=t;const n=h=>{a-=h,0>=a||e&&e()?(((t,s=S)=>{for(let e=s.length-1;e>=0;e--)s[e][0]===t&&s.splice(e,1)})(n),s&&s(1),i()):s&&s(1-a/t)};R(n),n(0)}))}var k;(t=>{t[t.EMPTY=0]="EMPTY",t[t.BOX=1]="BOX",t[t.DRAWER=2]="DRAWER",t[t.SHELF=3]="SHELF",t[t.DESKTOP=4]="DESKTOP",t[t.SERVER=5]="SERVER",t[t.CLOUD=6]="CLOUD",t[t.PLANT=7]="PLANT",t[t.DUDE=8]="DUDE",t[t.BOSS=9]="BOSS",t[t.PINATA=10]="PINATA",t[t.GOLD=11]="GOLD",t[t.SELL=12]="SELL",t[t.WILD=13]="WILD"})(k||(k={}));class O{constructor(t=0,s=0,e=0,i){this._count=Array(14),this._empty=!0,this._tiles=[],this._type=e,this._sprite=new E({...D.tile,n:"",x:t,y:s,f:e,p:i})}get type(){return this._type}set type(t){this._type=t,this._empty=!t,this._sprite.set({n:t?"tile":"",f:t})}set layer(t){this._sprite.set({l:t})}get sprite(){return this._sprite}get isWild(){return this.type==k.WILD}get isGold(){return this.type==k.GOLD}get isMovable(){return this.type==k.DUDE||this.type==k.BOSS}get targets(){if(this.type===k.DUDE)return this._tiles.filter((t=>t._empty));let t=[];return this.type===k.BOSS&&this.traverse((s=>!s._empty||t.push(s)>0)),t}get isLocked(){let t=!0;return this.traverse((s=>!(!t||!s.isMovable)&&(s.targets.length&&(t=!1),t))),t}get isHover(){return u(this._sprite.box,x)}add(t){return t&&this._tiles.push(t),this}traverse(t,s=[]){if(!s.includes(this)&&(s.push(this),t(this)))for(const e of this._tiles)e.traverse(t,s)}count(){const t=this._count.fill(0);if(this.isWild)for(const s of this._tiles)s._empty||s.isMovable||this.traverse((e=>(e.isWild||e.type===s.type)&&++t[s.type]>0));else this.traverse((s=>s.type===this.type&&++t[this.type]>0));return t}upgrade(t=this.type){k.CLOUD>t?this.type=t+1:k.GOLD>t?this.type=k.GOLD:t===k.WILD&&(this.type=k.PLANT)}async show(){await L(.2,(t=>this._sprite.set({s:t*t}))),this._sprite.set({s:1})}async move(){const t=this.targets;if(t.length){const s=t[t.length>1?c(t.length-1,0,!0):0],e=this.type;s._empty=!1,await this.moveTo(s),s.type=e}}async moveTo(t){const{x:s,y:e}=this._sprite.param,i=t._sprite.param;await L(.3,(t=>{const a=1-t*t;this._sprite.set({x:i.x-(i.x-s)*a,y:i.y-(i.y-e)*a,l:1})})),this._sprite.set({x:s,y:e,l:0}),this.type=k.EMPTY}async merge(t=this.type){const s=[];this.traverse((e=>(e===this||t===e.type)&&(this!==e&&s.push(e.moveTo(this)),!0))),s.length&&await Promise.all(s)}async lock(){await L(.2,(t=>this._sprite.set({r:Math.PI*t,s:1-t}))),this.type=10,await L(.2,(t=>this._sprite.set({r:Math.PI*(t+1),s:t}))),this._sprite.set({r:0,s:1})}async clear(){await L(.2,(t=>this._sprite.set({s:1-t*t}))),this._sprite.set({s:1})}}class _ extends y{constructor(t,s,e){super(t),this.width=s,this.height=e,this.tiles=[];for(let t=0;this.height>t;t++)for(let s=0;this.width>s;s++)this.tiles.push(new O(16*s-40,16*t-40,0,this));for(let t=0;this.height>t;t++)for(let s=0;this.width>s;s++)this.tile(s,t).add(this.tile(s-1,t)).add(this.tile(s+1,t)).add(this.tile(s,t-1)).add(this.tile(s,t+1))}load(t){this.tiles.forEach(((s,e)=>s.type=t[e]||0))}toJSON(){return this.tiles.map((t=>t.type))}tile(t,s){return 0>t||t>=this.width||0>s||s>this.height?null:this.tiles[this.height*s+t]}check(){return this.tiles.reduce(((t,s)=>(s.type>k.EMPTY?0:1)+t),0)}async setTile(t){const s=t.type,e=this.tiles.filter((t=>t.isHover)).pop();e&&(e.type!==k.EMPTY?(s===k.SELL||e.isGold)&&(await e.clear(),a({name:"clear",target:e}),e.type=k.EMPTY,await this.move(e)):s!==k.SELL&&(await t.moveTo(e),e.type=s,a({name:"place",target:e}),e.isMovable||await this.merge(e),await this.lock(e),await this.move(e)))}async move(t){const s=this.tiles.filter((s=>s.isMovable&&s!==t));s.length&&await Promise.all(s.map((t=>t.move())))}async merge(t){t.layer=2;let s=t.type,e=t.count();for(;e.filter((t=>t>2)).length;)s=e.reduce(((t,s,e)=>!t&&s>2?e:t),0),await t.merge(s),a({name:"merge",target:t,data:e[s]}),t.isWild||t.upgrade(s),e=t.count();t.isWild&&t.upgrade(s),t.layer=0}async lock(t){let s=this.tiles.filter((t=>t.isMovable&&t.isLocked));if(s.length)for(a({name:"lock",target:t,data:s}),await Promise.all(s.map((t=>t.lock())));s.length;){let e=s.length>1?c(s.length-1,0,!0):0;const i=0>s.indexOf(t)?s[e]:t;await this.merge(i),s=s.filter((t=>t.type&&t!==i))}}}class B extends y{constructor(t){super(t),this._data={coin:0,type:1,move:404,item:12},this.tile=new O(-40,-58,0,this),this.shop=new O(0,70,0,this),this.moveLbl=new T({...D.tiny,x:-30,y:-62,va:1,p:this},"Days"),this.moveTxt=new T({...D.font,x:-30,y:-55,va:1,p:this}),this.coinLbl=new T({...D.tiny,x:48,y:-62,va:1,ha:2,p:this},"Money"),this.coinTxt=new T({...D.font,x:48,y:-55,va:1,ha:2,p:this}),this.infoTxt=new T({...D.tiny,y:52,ha:1,p:this},"Click on empty tiles"),this.priceTxt=new T({...D.font,y:84,va:1,ha:1,p:this},"$9999"),this.infoIdx=0,this.infos=["Merge 3 objects","Merge more","Buy better stuff","Subscribers have discount!","Collect the gold bars","Pinata party is cool"],this.load(this._data)}get type(){return this._data.type}set type(t){this._data.type=t,this.tile.type=t,this.move--}get move(){return this._data.move}set move(t){this._data.move=t,this.moveTxt.text(""+t)}get coin(){return this._data.coin}set coin(t){this._data.coin=t,this.enabled=this.enabled,this.coinTxt.text("$"+t)}get price(){return D.price[this.item]}get item(){return this._data.item}set item(t){this._data.item=t,this.shop.type=t,this.enabled=this.enabled,this.priceTxt.text(t?"$"+this.price:"Free")}get enabled(){return this.coin>=this.price}set enabled(t){const s=t?1:.5;this.shop.sprite.set({a:s}),this.priceTxt.set({a:s})}load(t){this.type=t.type,this.coin=t.coin,this.move=t.move,this.item=t.item}async buy(t){const s=this.price,e=this.shop.type;a({name:"buy",target:this.shop,data:s}),await this.shop.moveTo(this.tile),this.item=t,this.coin-=s,this.type=e,this.move++,await this.shop.show(),this.help()}async info(t){await L(.2,(t=>this.infoTxt.set({a:1-t*t}))),this.infoTxt.text(t),await L(.3,(t=>this.infoTxt.set({a:t*t})))}show(){this.tile.show(),this.help()}help(){switch(this.type){case k.PLANT:this.info("Hmm... a plant?");break;case k.DUDE:this.info("Hey dude!");break;case k.BOSS:this.info("Bosses are annoying!");break;case k.SELL:this.info("You can sell something!");break;case k.WILD:this.info("Diamond merge all stuff!");break;default:this.info(this.infos[this.infoIdx]),++this.infoIdx<this.infos.length||(this.infoIdx=0)}}toJSON(){return this._data}}class F extends y{constructor(){super(...arguments),this.scoreTxt=new T({...D.tiny,c:"fff",ha:1,va:1,l:3,p:this})}async score(t,s){const{x:e,y:i}=t.sprite.param;this.scoreTxt.text("$"+s),this.scoreTxt.set({x:e,y:i,a:0}),await L(.2,(t=>this.scoreTxt.set({a:t}))),await L(.3),this.scoreTxt.set({a:0})}}class G extends y{constructor(t,s){super(t),this.time=0,this.loop=!1,this.length=0,this.active=!1,this.finished=!0,this.particles=[],this.update=t=>{if(!this.loop&&this.time>this.length){if(this.finished)return;return this.finished=!0,void(this.props.of&&this.props.of(this))}const s=this.props,e=G.pos,{v:i,c:a,w:n,h,s:o,t:r,ou:l}=s;let{a:u,r:d}=s;u=Math.abs(u),c.SEED=o,this.time+=t,this.active=this.loop||this.length-r>this.time,this.particles.forEach(((f,m)=>{const y=o?c(r):r,w=(y+this.time)%r,x=Math.floor((this.time+r-w)/r),g=Math.min(t,w),v=w-g;let{x:A,y:E}=this.param;A+=n?c(n,x)-n/2:0,E+=h?c(h,x)-h/2:0;const T=w>t?f.param:{...this.param,x:A,y:E};e.x=0,e.y=i*g,p(e,d-(o?c(u,x):u/a*m)+u/2),e.x+=s.x*w*w-s.x*v*v+T.x,e.y+=s.y*w*w-s.y*v*v+T.y;const b={...T,...e};l&&l(b,w/r,x),(0>this.time||w>this.time||!this.loop&&r*x+r-y>this.length)&&(b.a=0),f.set(b,null)}))},this.props={x:0,y:0,v:0,r:0,a:0,c:1,s:0,t:1,...s};for(let s=0;this.props.c>s;s++)this.particles.push(new E(t))}start(t=-1,s=0,e=this.props.s){this.time=-s,this.loop=0>t,this.length=t+this.props.t,this.props.s=e,this.active=!0,this.finished=!1}stop(t=0){this.length=this.time+this.props.t+t,this.active=!1,this.loop=!1}}G.pos=((t=0,s=0)=>({x:t,y:s}))();class U extends y{constructor(t){super(t),this.back=new E({...D.ptc,s:24,f:3,c:"000a",l:4,p:this}),this.txt1=new T({...D.font,y:-12,ha:1,l:4,p:this},"You are"),this.txt2=new T({...D.font,ha:1,l:4,p:this}),this.color=["f00","0c0","00f","fc0","0ff","f0f"],this.emitter=new G({...D.ptc,y:4,f:1,l:4,p:this},{c:40,a:.5,v:-100,y:150,w:90,h:90,s:c(),t:.7,ou:(t,s,e)=>{let i=this.color;t.a=1-s**4,t.l=c(1,e,!0)+4,t.r=c(3,e)+3*s,t.c=i[c(i.length-1,e,!0)]}}),this.hide(!1),R(this.emitter.update)}async show(t,s){s&&this.emitter.start(),this.txt2.text(t+"!"),await L(.3,(t=>{this.back.set({a:t}),this.txt1.set({a:t,s:t>.2?3-2*t:0}),this.txt2.set({a:t,s:t>.6?5-4*t:0})}))}async hide(t=!0){this.emitter.active&&this.emitter.stop(),t&&await L(.3,(t=>{const s=1-t*t;this.back.set({a:s}),this.txt1.set({a:s}),this.txt2.set({a:s})})),this.back.set({a:0}),this.txt1.set({a:0}),this.txt2.set({a:0})}emit(t){this.emitter.start(t)}}class N extends E{constructor(t,s){super(t),this.props=s;const{w:e,h:i,m:a}=s,n=Array(e*i).fill(-1),h=Array(e*i).fill(0);let o=0,r=0;for(;a.length>o;){let t=a.charAt(o++),s="|-+".indexOf(t)+1,e=1;s&&(t=a.charAt(o++)),t.match(/[A-Z]/)?t=t.toLowerCase():e=parseInt(a.charAt(o++),36)+1,"0"!==t&&(n.fill(parseInt(t,36)-10,r,r+e),h.fill(s,r,r+e)),r+=e}n.forEach(((t,e)=>{if(0>t)return;const{n:i,w:a,h:n,l:o,c:r}=this.param,c=s.h*n/2;new E({n:i,w:a,h:n,l:o,c:r,f:t,x:e%s.w*a+a/2-s.w*a/2,y:Math.floor(e/s.w)*n+n/2-c,px:a/2,py:n/2,sx:1&h[e]?-1:1,sy:2&h[e]?-1:1,p:this})})),this.param.n=""}}const H={scenes:[]},Q=new class{constructor(t,s=localStorage){this.prefix=t,this.store=s}key(t){return this.prefix+t}set(t,s=""){void 0!==t?this.store.setItem(this.key(s),JSON.stringify(t)):this.store.removeItem(this.key(s))}get(t=""){try{return JSON.parse(this.store.getItem(this.key(t)))}catch(t){}return null}}("office_404");class Y extends y{constructor(t){super(),this.hud=new B({p:this}),this.grid=new _({p:this},6,6),this.back=new N({...D.tile,x:8,y:8,p:this},{w:6,h:6,m:"az"}),this.score=new F({p:this}),this.overlay=new U({p:this}),this.active=!0,this.ended=!1,this.onInput=async t=>{if("Mouse0"===t.target){const{hud:t,grid:s}=this;this.ended?(this.overlay.hide(),this.create()):this.active&&(this.active=!1,t.enabled&&t.shop.isHover?await t.buy(this.roll(D.shop)):await s.setTile(t.tile),s.check()?t.move?this.save():(this.clear(),this.ended=!0,a({name:"promoted"}),this.overlay.show("promoted",!0)):(this.clear(),this.ended=!0,a({name:"fired"}),this.overlay.show("fired",!1)),this.active=!0)}},this.onPlace=()=>{this.hud.type=this.roll(),this.hud.show()},this.onMerge=t=>{const s=t.target;this.coin(s,t.data),s.type===k.PINATA?(this.overlay.emit(.4),M.play("pinata")):M.play("coin")},this.onClear=t=>{const s=t.target;this.coin(s),s.isGold||(this.hud.type=this.roll(),this.hud.show())},this.onALL=t=>{M.play(t.name)},e("down",this.onInput)("place",this.onPlace)("merge",this.onMerge)("clear",this.onClear)("all",this.onALL),t?(this.hud.load(t.hud),this.grid.load(t.grid)):this.create()}create(){for(const t of this.grid.tiles)t.type=this.roll(D.init);this.hud.load({coin:0,type:1,move:404,item:12}),this.ended=!1,this.save()}save(){const{hud:t,grid:s}=this;Q.set({hud:t,grid:s})}clear(){Q.set()}coin(t,s=1){const e=D.coin[t.type]*s;e&&(this.score.score(t,e),this.hud.coin+=e)}roll(t=D.odds){let s=c(99);for(let e=t.length-1;e>0;e--){if(t[e]&&t[e]>s)return e;s-=t[e]}return 0}}class K extends y{constructor(t){super(t),this.sound=1,this.twtIcon=new E({...D.icon,x:-40,y:84,f:3,a:0,p:this}),this.sndIcon=new E({...D.icon,x:40,y:84,f:1,a:0,p:this}),this.onInput=async t=>{if("Mouse0"===t.target&&(u(this.sndIcon.box,x)&&(++this.sound>2&&(this.sound=0),this.sndIcon.set({f:this.sound}),a({name:"sound",data:this.sound})),u(this.twtIcon.box,x))){const t=new URLSearchParams;t.set("url",location.href),t.set("text","Check out OFFICE 404!"),t.set("hashtags","js13k,office404"),window.open("http://www.twitter.com/share?"+t,"_blank")}},e("down",this.onInput)}async show(){await L(.5,(t=>{const s=t*t;this.twtIcon.set({a:s}),this.sndIcon.set({a:s})}))}}class z extends y{constructor(){super(),this.data=Q.get(),this.num=new T({...D.font,y:-10,r:.3,c:"900",ha:1,p:this}),this.logo=new T({...D.font,s:2,c:"eee",va:1,ha:1,p:this}),this.newTxt=new T({...D.font,y:0,ha:1,p:this}),this.loadTxt=new T({...D.font,y:12,ha:1,p:this}),this.clickTxt=new T({...D.tiny,y:12,ha:1,p:this}),this.settings=new K({p:this}),this.clicked=!1,this.onInit=async t=>{if("Mouse0"===t.target){i("down",this.onInit),this.clicked=!0,this.clickTxt.text("Loading...");const t=["sine",.2,[.2,0],0],e=[(s=t=>4/(t*Math.PI)*Math.sin(Math.PI*t*.18),Array.from({length:8191},((t,e)=>s(e+1)))),.3,[.5,.2],0],a=[[1,1,1,1,0,1,0,1,0,0,0,1],.3,[.1,.2,.1],0],n=[[1,.81,.21,.021],.2,[.3,0],0],h=["sine",.3,[1,.1,0],0],o=["sine",.2,0,[1,0]];await M.init(),await M.sound("place",h,[110,15,0]),await M.sound("lock",["triangle",.4,[0,.2],0],[880,220,880]),await M.music("clear",[[["square",.2,[.2,0],0],"1a6,1c7,1e7",.05]]),await M.music("coin",[[t,"2a4,2a5",.05]]),await M.music("buy",[[t,"2a6,2e7,2a7",.05]]),await M.sound("fired",["triangle",1,[.3,0],[.2,0]],[880,110]),await M.music("promoted",[[t,"1f5a5c6,3f5a5c6,1f5a5c6,3g5b5d6,4a5c6e6",.1],[e,"1f6,3f6,1f6,3g6,4a6",.1],[n,"4f3,1f3,3g3,4a3",.1]]),await M.music("pinata",[[t,"2g4b4d5,1g4b4d5,1g4b4d5,4c5e5g5",.1],[e,"2g6,1g6,1g6,4c7",.1],[n,"2g2,1g2,1g2,4c3",.1]]),await M.music("music",[[e,"8|8|1a5,1,1a5,1,2d6,1e6,2f6,7,2e6,2,2e6,2c6,4g5,4,8f6,4e6,20,1a5,1,1a5,1,2d6,1e6,2f6,7,2e6,2,2e6,2c6,4g5,4,8d6,4c6,20|2",.125],[a,"8a4d5f5,8a4c5e5,8g4c5e5,8g4b4d5|10",.125],[n,"1a2,1a2,3f3,1d2,2,1a2,1a2,3e3,1c2,2,1g2,1g2,3e3,1c2,2,1g2,1g2,3d3,1b2,2|8",.125],[h,"1a3,7,1a3,1,1a3,5|20",.125],[o,"8|8|4,1a7,3|24",.125]]),this.sound=this.settings.sound,await this.start()}var s},this.onInput=async t=>{const s=this.load;"Mouse0"===t.target&&(s||this.create)&&(this.hide(),i("down",this.onInput)("pointer",this.onPointer),M.play("music",!0,"music"),e("sound",(t=>this.sound=t.data)),H.scenes[1]=new Y(s?this.data:null))},this.onPointer=()=>{this.loadTxt.set({c:this.load?"0ff":"fff"}),this.newTxt.set({c:this.create?"0ff":"fff"})},this.onCoil=()=>{D.price=D.coil,this.logo.set({c:"c90"})},this.intro(),e("coil",this.onCoil)("down",this.onInit)}get load(){return u(this.loadTxt.box,x)}get create(){return u(this.newTxt.box,x)}set sound(t){M.mixer("master",t>0?.8:0),M.mixer("music",1===t?.2:0)}async intro(){const t=()=>this.clicked;await L(.5,void 0,t),await L(1.5,(t=>this.logo.text("Office".substr(0,Math.ceil(6*t)))),t),this.num.text("404!"),await L(.3,(t=>this.num.set({x:34*t,s:3.7-2*t*t,a:t*t})),t),await L(.5,void 0,t),!this.clicked&&this.clickTxt.text("Click to start")}async start(){this.clickTxt.text(),await L(.5,(t=>{const s=t**4;this.logo.set({y:-80*s}),this.num.set({y:-80*s-10})})),this.newTxt.text("New game"),this.data&&(this.newTxt.set({y:-12}),this.loadTxt.text("Continue")),await L(.3,(t=>{this.newTxt.set({a:t*t}),this.loadTxt.set({a:t*t})})),e("down",this.onInput)("pointer",this.onPointer),await this.settings.show()}async hide(){await L(.5,(t=>{const s=1-t*t;this.newTxt.set({a:s}),this.loadTxt.set({a:s})}))}}const X=new Map;function J(t,s=X){for(let e=t.length-1;e>=0;e--){const i=t[e];if(J(i.children,s),i instanceof E){const{n:t,l:e}=i.param;t&&(s.has(e)||s.set(e,[]),s.get(e).push(i))}}}function V(t,s,e){const{param:i,tint:a,mesh:n}=s,{pos:h,color:o,count:r,size:c}=t;if(i.n in e.frames&&c>r){((t,s,e)=>{let{n:i,f:a,w:n,h}=s;const[o,r]=e.size,c=e.margin/o;let[l,p]=e.frames[i];l/=o,p/=r,n/=o,h/=r,l+=(n+c)*Math.floor(a),t.uv.set([l,p,l+n,p,l,p+h,l+n,p+h],8*t.count)})(t,i,e),h.set(n,8*r);let s=16*r;for(let t=0;4>t;t++)o.set(a,4*t+s);t.count++}}const j=w.gl,W=((t=4096)=>{const s=new Uint16Array(6*t),e=[0,1,2,2,1,3];for(let t=0;s.length>t;t++)s[t]=4*Math.floor(t/6)+e[t%6];return{idx:s,uv:new Float32Array(8*t),pos:new Float32Array(8*t),color:new Float32Array(16*t),count:0,size:t}})(),Z=new class{constructor(t,s,e){this.gl=t,this.buffers={},this.textures={},this.locations={};const i=t.createProgram();t.attachShader(i,this.compile(t.VERTEX_SHADER,s)),t.attachShader(i,this.compile(t.FRAGMENT_SHADER,e)),t.linkProgram(i),this.program=i}compile(t,s){const e=this.gl,i=e.createShader(t);return e.shaderSource(i,s),e.compileShader(i),i}buff(t,s){const e=this.gl,i=this.buffers,a=s instanceof Float32Array?e.ARRAY_BUFFER:e.ELEMENT_ARRAY_BUFFER;return t in i||(i[t]=e.createBuffer()),e.bindBuffer(a,i[t]),e.bufferData(a,s,e.STATIC_DRAW),this}txt(t,s,e=!0){const i=this.gl,a=this.textures;if(s){const n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e?i.NEAREST:i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,s),a[t]=n}else t in a&&i.bindTexture(i.TEXTURE_2D,a[t]);return this}attr(t,s,e){const i=this.gl,a=this.locations;return this.buff(t,e),t in a||(a[t]=i.getAttribLocation(this.program,t),i.enableVertexAttribArray(a[t]),i.vertexAttribPointer(a[t],s,i.FLOAT,!1,0,0)),this}uni(t,s,e){const i=this.gl,a=this.locations;t in a||(a[t]=i.getUniformLocation(this.program,t));const n=a[t];if("number"==typeof s)i.uniform1f(n,s);else switch(e||s.length){case 2:i.uniform2fv(n,s);break;case 3:i.uniform3fv(n,s);break;case 4:i.uniform4fv(n,s);break;case 9:i.uniformMatrix3fv(n,!1,s);break;case 16:i.uniformMatrix4fv(n,!1,s)}return this}}(j,"precision lowp float;attribute vec2 aUv;attribute vec2 aPos;attribute vec4 aColor;uniform mat3 uProj;varying vec2 vUv;varying vec4 vColor;void main(){vUv=aUv;vColor=aColor;gl_Position=vec4(uProj*vec3(aPos,1),1);}","precision lowp float;uniform sampler2D uImage;varying vec2 vUv;varying vec4 vColor;void main(){gl_FragColor=texture2D(uImage,vUv)*vColor;gl_FragColor.rgb*=gl_FragColor.a;}"),q=new Image,$=H.scenes;R((()=>{J($),((t,s,e=X.keys(),i=X)=>{t.count=0;for(const a of e){const e=i.get(a);e&&(e.forEach((e=>V(t,e,s))),e.length=0)}})(W,A),j.clear(j.COLOR_BUFFER_BIT),Z.uni("uProj",w.mat).attr("aUv",2,W.uv).attr("aPos",2,W.pos).attr("aColor",4,W.color),j.drawElements(j.TRIANGLES,6*W.count,j.UNSIGNED_SHORT,0)}),9),e("load",(()=>{const t=document;$[0]=new z,j.enable(j.BLEND),j.clearColor(0,0,0,1),j.blendFunc(j.ONE,j.ONE_MINUS_SRC_ALPHA),j.useProgram(Z.program),Z.buff("indices",W.idx).txt("sprite",q),C(),e("click",(()=>r&&(async()=>document.fullscreenElement||await document.body.requestFullscreen())()),t),t.monetization&&e(t.monetization,"monetizationstart",(()=>a({name:"coil"})))}),q),q.src="data:image/png;base64,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"}();</script></body></html>